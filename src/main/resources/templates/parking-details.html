<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head}"></head>

<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="container">

    <nav aria-label="breadcrumb" style="margin-bottom: 20px;">
        <ul>
            <li><a href="/parkings" class="secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a></li>
        </ul>
    </nav>

    <div class="grid">

        <div>
            <hgroup>
                <h1 th:text="${parking.name}" style="margin-bottom: 5px;">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∫–æ–≤–∫–∏</h1>
                <p style="color: gray; font-size: 1.1rem;">
                    üìç <span th:text="${parking.address}">–ê–¥—Ä–µ—Å</span>
                </p>
            </hgroup>

            <div style="margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                <div style="background: #FFF8E1; color: #FFA000; padding: 5px 10px; border-radius: 8px; font-weight: bold;">
                    ‚òÖ <span th:text="${parking.averageRating}">4.5</span>
                </div>
                <small style="color: gray;">(–Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–∑—ã–≤–æ–≤)</small>
            </div>

            <article>
                <header style="margin-bottom: 10px; font-weight: bold;">–£–¥–æ–±—Å—Ç–≤–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</header>
                <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                    <div th:if="${parking.isForDisabled}">‚ôø –î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤</div>
                    <div th:if="${parking.hasSecurity}">üëÆ –û—Ö—Ä–∞–Ω–∞</div>
                    <div th:if="${parking.hasCctv}">üìπ –ö–∞–º–µ—Ä—ã</div>
                    <div th:if="${parking.hasLighting}">üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</div>
                    <div th:if="${parking.hasEvCharger}">‚ö° –ó–∞—Ä—è–¥–∫–∞ EV</div>
                    <div th:if="${parking.hasBarrier}">üöß –®–ª–∞–≥–±–∞—É–º</div>
                </div>
                <p th:if="${!parking.isForDisabled and !parking.hasSecurity and !parking.hasCctv and !parking.hasLighting and !parking.hasEvCharger}" style="color: gray; font-style: italic;">
                    –û–ø–∏—Å–∞–Ω–∏–µ —É–¥–æ–±—Å—Ç–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
                </p>
            </article>
        </div>

        <div>
            <article style="border: 2px solid #1095c1; position: sticky; top: 20px;">
                <header style="text-align: center; background-color: #1095c1; color: white;">
                    <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã</strong>
                </header>

                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="margin-bottom: 0; color: #1095c1;">
                        <span th:text="${parking.pricePerHour}">100</span> ‚ÇΩ
                    </h2>
                    <small>–∑–∞ —á–∞—Å</small>
                    <hr style="margin: 15px 0;">
                    <p style="margin-bottom: 0;">
                        <span th:text="${parking.pricePerDay}">800</span> ‚ÇΩ / —Å—É—Ç–∫–∏
                    </p>
                </div>

                <a th:href="@{/bookings/create/{id}(id=${parking.id})}"
                   role="button"
                   class="contrast"
                   style="width: 100%;">
                    üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ
                </a>

                <div sec:authorize="isAuthenticated()" style="margin-top: 15px;">
                    <a th:href="@{/parkings/{id}/delete(id=${parking.id})}"
                       th:if="${parking.ownerId == #authentication.principal.user.id or #authorization.expression('hasAnyRole(''MODERATOR'', ''ADMIN'')')}"
                       onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–∞—Ä–∫–æ–≤–∫—É –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ?');"
                       role="button"
                       class="outline secondary"
                       style="width: 100%; border-color: #ff6b6b; color: #ff6b6b;">
                        üóë –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∫–æ–≤–∫—É
                    </a>
                </div>
            </article>
        </div>
    </div>

    <hr style="margin: 40px 0;">

    <h3>üí¨ –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>

    <div class="grid">

        <div>
            <div th:if="${#lists.isEmpty(parking.reviews)}" style="padding: 20px; background: #f0f0f0; border-radius: 8px; color: gray;">
                –û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!
            </div>

            <article th:each="review : ${parking.reviews}" style="margin-bottom: 15px; padding: 15px;">
                <header style="margin-bottom: 10px; border-bottom: none; padding-bottom: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong><span th:text="${review.authorName}">–ò–º—è</span></strong>
                        <div style="color: #FFA000;">
                            <span th:each="i : ${#numbers.sequence(1, review.rating)}">‚òÖ</span>
                        </div>
                    </div>
                </header>
                <p th:text="${review.comment}" style="margin-bottom: 10px;">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞...</p>
                <footer style="margin-top: 0; padding-top: 0; border-top: none; font-size: 0.8rem; color: gray;">
                    <span th:text="${#temporals.format(review.createdAt, 'dd.MM.yyyy HH:mm')}">–î–∞—Ç–∞</span>
                </footer>
            </article>
        </div>

        <div>
            <div sec:authorize="isAuthenticated()">
                <article style="background-color: #1e262e; border: 1px solid #333;">
                    <header style="border-bottom: 1px solid #333;">‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</header>

                    <form th:action="@{/reviews/add}" method="post">
                        <input type="hidden" name="parkingId" th:value="${parking.id}">

                        <label>–û—Ü–µ–Ω–∫–∞
                            <select name="rating" required style="background-color: #2d3748; color: white; border: 1px solid #444;">
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê - –•–æ—Ä–æ—à–æ</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê - –ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                                <option value="2">‚≠ê‚≠ê - –ü–ª–æ—Ö–æ</option>
                                <option value="1">‚≠ê - –£–∂–∞—Å–Ω–æ</option>
                            </select>
                        </label>

                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                            <textarea name="comment" rows="3" required placeholder="–ù–∞–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –ø—Ä–æ—à–ª–∞ –ø–∞—Ä–∫–æ–≤–∫–∞..." style="background-color: #2d3748; color: white; border: 1px solid #444;"></textarea>
                        </label>

                        <button type="submit" class="contrast">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                    </form>
                </article>
            </div>

            <div sec:authorize="!isAuthenticated()">
                <article style="text-align: center;">
                    <p>–•–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤?</p>
                    <a href="/login" role="button" class="outline">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a>
                </article>
            </div>
        </div>
    </div>

</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>