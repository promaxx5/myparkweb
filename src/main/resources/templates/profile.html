<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head}"></head>

<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="container">

    <div class="grid">

        <div>
            <article>
                <header style="text-align: center; background-color: #1e262e; color: white;">
                    <strong>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</strong>
                </header>

                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 4rem; margin-bottom: 10px;">üë§</div>

                    <h3 th:text="${user.fullName}" style="margin-bottom: 5px;">–ò–º—è –§–∞–º–∏–ª–∏—è</h3>
                    <p th:text="${user.email}" style="color: #a0aec0; font-size: 0.9rem;">email@test.com</p>

                    <hr style="margin: 20px 0;">

                    <small style="color: gray; display: block; margin-bottom: 10px;">–í–∞—à–∏ —Ä–æ–ª–∏:</small>
                    <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                        <span th:each="r : ${user.roles}"
                              th:text="${r.name}"
                              style="background-color: #2d3748; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; color: #e2e8f0;">
                            DRIVER
                        </span>
                    </div>
                </div>
            </article>
        </div>

        <div>

            <div sec:authorize="hasAnyRole('DRIVER', 'BOTH', 'ADMIN')">
                <h3 style="border-bottom: 2px solid #1095c1; padding-bottom: 10px; display: inline-block;">
                    üöó –ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è
                </h3>

                <details open style="margin-bottom: 20px;">
                    <summary role="button" class="secondary outline">
                        –ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ (<span th:text="${myCars.size()}">0</span>)
                    </summary>

                    <div class="grid" style="margin-top: 15px; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">

                        <article th:each="car : ${myCars}" style="padding: 15px; border: 1px solid #2d3748; margin-bottom: 0;">
                            <header style="padding: 0; border: none; margin-bottom: 10px;">
                                <strong th:text="${car.make} + ' ' + ${car.model}" style="color: #1095c1;">BMW X5</strong>
                            </header>
                            <div style="background: #2d3748; padding: 5px; text-align: center; border-radius: 4px; font-family: monospace;">
                                <span th:text="${car.licensePlate}">A000AA 77</span>
                            </div>
                        </article>

                        <a href="/cars/add"
                           role="button"
                           class="outline dashed"
                           style="border: 2px dashed #444; display: flex; align-items: center; justify-content: center; text-decoration: none; color: gray; height: auto; min-height: 100px;">
                            + –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ
                        </a>
                    </div>
                </details>

                <details>
                    <summary role="button" class="outline">–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</summary>
                    <figure>
                        <table role="grid">
                            <thead>
                            <tr>
                                <th>–ü–∞—Ä–∫–æ–≤–∫–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="trip : ${myTrips}">
                                <td>
                                    <a th:href="@{/parkings/{id}(id=${trip.parking.id})}" th:text="${trip.parking.name}">–ü–∞—Ä–∫–æ–≤–∫–∞</a>
                                </td>
                                <td style="font-size: 0.85rem;">
                                    <span th:text="${#temporals.format(trip.startTime, 'dd.MM HH:mm')}"></span> <br>
                                    <span style="color: gray;">‚¨á</span> <br>
                                    <span th:text="${#temporals.format(trip.endTime, 'dd.MM HH:mm')}"></span>
                                </td>
                                <td><strong th:text="${trip.totalCost} + ' ‚ÇΩ'">500 ‚ÇΩ</strong></td>
                                <td>
                                    <span th:if="${trip.status == 'ACTIVE'}" style="color: #4cd964; font-weight: bold;">‚óè –ê–∫—Ç–∏–≤–Ω–æ</span>
                                    <span th:if="${trip.status == 'CANCELLED'}" style="color: #ff3b30;">‚óè –û—Ç–º–µ–Ω–∞</span>
                                    <span th:if="${trip.status == 'COMPLETED'}" style="color: gray;">‚óè –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </figure>
                    <p th:if="${myTrips.empty}" style="text-align: center; color: gray;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–µ–∑–¥–æ–∫.</p>
                </details>
            </div>

            <hr sec:authorize="hasRole('BOTH')" style="margin: 40px 0; border-top: 1px dashed #444;">

            <div sec:authorize="hasAnyRole('OWNER', 'BOTH', 'ADMIN', 'MODERATOR')">
                <h3 style="border-bottom: 2px solid #ff9800; padding-bottom: 10px; display: inline-block;">
                    üÖøÔ∏è –ö–∞–±–∏–Ω–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞
                </h3>

                <details open style="margin-bottom: 20px;">
                    <summary role="button" class="secondary outline">
                        –ú–æ–∏ –ø–∞—Ä–∫–æ–≤–∫–∏ (<span th:text="${myParkings.size()}">0</span>)
                    </summary>

                    <div class="grid" style="margin-top: 15px;">
                        <article th:each="p : ${myParkings}" style="padding: 15px; border-left: 4px solid #ff9800;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <strong th:text="${p.name}" style="font-size: 1.1rem;">–ù–∞–∑–≤–∞–Ω–∏–µ</strong>
                                    <p th:text="${p.address}" style="color: gray; font-size: 0.9rem; margin-bottom: 5px;">–ê–¥—Ä–µ—Å</p>
                                </div>
                                <a th:href="@{/parkings/{id}(id=${p.id})}" role="button" class="outline" style="padding: 5px 10px; font-size: 0.8rem;">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                            </div>
                            <footer style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; font-size: 0.85rem;">
                                –†–µ–π—Ç–∏–Ω–≥: <span style="color: #ff9800;">‚òÖ <span th:text="${p.averageRating}">0.0</span></span>
                            </footer>
                        </article>
                    </div>

                    <div style="margin-top: 15px; text-align: center;">
                        <a href="/parkings/add" role="button" class="contrast">+ –°–¥–∞—Ç—å –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ</a>
                    </div>
                </details>

                <details>
                    <summary role="button" class="outline">–í—Ö–æ–¥—è—â–∏–µ –∑–∞–∫–∞–∑—ã (–ö–ª–∏–µ–Ω—Ç—ã)</summary>
                    <figure>
                        <table role="grid">
                            <thead>
                            <tr>
                                <th>–û–±—ä–µ–∫—Ç</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–ê–≤—Ç–æ</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–°—É–º–º–∞</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="inc : ${incomingBookings}">
                                <td th:text="${inc.parking.name}">–ì–∞—Ä–∞–∂</td>
                                <td>
                                    <span th:text="${inc.driver.fullName}">–ò–≤–∞–Ω</span>
                                </td>
                                <td style="font-family: monospace;" th:text="${inc.car.licensePlate}">A777AA</td>
                                <td>
                                    <small th:text="${#temporals.format(inc.startTime, 'dd.MM HH:mm')}"></small>
                                </td>
                                <td style="color: #4cd964; font-weight: bold;" th:text="${'+' + inc.totalCost + ' ‚ÇΩ'}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </figure>
                    <p th:if="${incomingBookings.empty}" style="text-align: center; color: gray;">–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–∞ –≤–∞—à–∏—Ö —Ç–æ—á–∫–∞—Ö.</p>
                </details>
            </div>

        </div>
    </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>